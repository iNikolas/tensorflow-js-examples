import{R as i,j as c}from"./index-qOZqXyW5.js";import{c as m,f as S}from"./helpers-Cs5YJYh0.js";import{M as j}from"./view-CsJ7CpAI.js";import{s as w,d as u,T as P}from"./view-0IN3Gxp2.js";import{d9 as T,cV as f,c6 as b,da as M,d8 as N,t as E,a5 as R}from"./register_all_kernels-YBgeH-G1.js";const I=10,v=.001,z=16,g=30,A=2e3,U=.01;async function V(e){const n=[],r=[];for(let t=0;t<I;t=t+v)n.push(t),r.push(t*t);await T();const o=f(n),a=f(r),s=w();s.add(u({inputShape:[1],units:20,activation:"relu"})),s.add(u({units:20,activation:"relu"})),s.add(u({units:1})),s.compile({optimizer:M.adam(U),loss:b.meanSquaredError});const d=await s.fit(o,a,{batchSize:z,...e});return N([o,a]),{model:s,history:d}}function q(){const[e,n]=i.useState(0),[r,o]=i.useState(1/0),a=i.useRef(0),[s,d]=i.useState(null),[t,l]=i.useState(!1);return i.useEffect(()=>((async()=>{if(s||t)return;l(!0);const{model:y}=await V({epochs:g,callbacks:{onEpochEnd:(x,h)=>{n(x/g*100);const p=Date.now();p-a.current>A&&(a.current=p,o(h?.loss??1/0))}}});d(y),l(!1)})(),()=>{s&&s.dispose()}),[t,s]),{trainingProgress:e,loss:r,model:s,isTraining:t}}function k({value:e,model:n}){const[r,o]=i.useState(0),[a,s]=i.useState(!1);return i.useEffect(()=>{(async()=>{if(!(!n||e==null))try{s(!0);const t=E(()=>n.predict(R([e])));if(Array.isArray(t))throw new Error("Something went wrong. Unexpected result type");const l=Array.from(await t.data())[0];t.dispose(),o(l)}finally{s(!1)}})()},[n,e]),{prediction:r,isPredicting:a}}function H(){const[e,n]=i.useState(10),{trainingProgress:r,loss:o,model:a,isTraining:s}=q(),{prediction:d,isPredicting:t}=k({value:e,model:a});return c.jsxs("section",{className:m("prose p-4"),children:[s?c.jsx(P,{trainingProgress:r,loss:o}):c.jsxs("section",{className:"text-center",children:[c.jsx("input",{value:e,onChange:l=>n(Number(l.target.value)),disabled:!a||s,placeholder:"Type here",className:"input",type:"number"}),c.jsxs("label",{className:"input",children:[c.jsx("input",{value:S(d),type:"text",className:m("grow transition-all",t?"opacity-0":"opacity-100"),disabled:!0}),t&&c.jsx("span",{className:"loading loading-spinner"})]})]}),c.jsx(j,{})]})}export{H as default};
